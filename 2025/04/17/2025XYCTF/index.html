

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Agent">
  <meta name="keywords" content="Crypto,Reverse,算法,编程技术,日常">
  
    <meta name="description" content="连接端口12345from pwn import *io &#x3D; remote(&#x27;gz.imxbt.cn&#x27;, 20611)print(io.recv().decode())  # 打印欢迎信息io.interactive()          # 进入交互模式（手动输入）    Division原题： 1234567891011121314151617181920212223242">
<meta property="og:type" content="article">
<meta property="og:title" content="2025XYCTFCTF">
<meta property="og:url" content="http://tow-086.github.io/2025/04/17/2025XYCTF/index.html">
<meta property="og:site_name" content="Agent的个人博客">
<meta property="og:description" content="连接端口12345from pwn import *io &#x3D; remote(&#x27;gz.imxbt.cn&#x27;, 20611)print(io.recv().decode())  # 打印欢迎信息io.interactive()          # 进入交互模式（手动输入）    Division原题： 1234567891011121314151617181920212223242">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://tow-086.github.io/5E283890C76F7FF717066E073BA880D8.jpg">
<meta property="og:image" content="https://picx.zhimg.com/80/v2-4cd29979ffa498905e34d294cc0fc69a_1440w.png">
<meta property="article:published_time" content="2025-04-17T04:00:00.000Z">
<meta property="article:modified_time" content="2025-06-06T04:01:15.936Z">
<meta property="article:author" content="Agent">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="密码">
<meta property="article:tag" content="好题">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://tow-086.github.io/5E283890C76F7FF717066E073BA880D8.jpg">
  
  
  
  <title>2025XYCTFCTF - Agent的个人博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"tow-086.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Agent的个人博客" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="2025XYCTFCTF"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-04-17 12:00" pubdate>
          2025年4月17日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.5k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          38 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">2025XYCTFCTF</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="连接端口"><a href="#连接端口" class="headerlink" title="连接端口"></a>连接端口</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = remote(<span class="hljs-string">&#x27;gz.imxbt.cn&#x27;</span>, <span class="hljs-number">20611</span>)<br><span class="hljs-built_in">print</span>(io.recv().decode())  <span class="hljs-comment"># 打印欢迎信息</span><br>io.interactive()          <span class="hljs-comment"># 进入交互模式（手动输入）</span><br></code></pre></td></tr></table></figure>



<h1 id="Division"><a href="#Division" class="headerlink" title="Division"></a>Division</h1><p>原题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><br><span class="hljs-comment"># -*- encoding: utf-8 -*-</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">@File    :   server.py</span><br><span class="hljs-string">@Time    :   2025/03/20 12:25:03</span><br><span class="hljs-string">@Author  :   LamentXU </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-keyword">import</span> random <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;----Welcome to my division calc----&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">menu:</span><br><span class="hljs-string">      [1]  Division calc</span><br><span class="hljs-string">      [2]  Get flag</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    choose = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;: &gt;&gt;&gt; &#x27;</span>)<br>    <span class="hljs-keyword">if</span> choose == <span class="hljs-string">&#x27;1&#x27;</span>:<br>        <span class="hljs-keyword">try</span>:<br>            denominator = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;input the denominator: &gt;&gt;&gt; &#x27;</span>))<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;INPUT NUMBERS&#x27;</span>)<br>            <span class="hljs-keyword">continue</span><br>        nominator = random.getrandbits(<span class="hljs-number">32</span>)<br>        <span class="hljs-keyword">if</span> denominator == <span class="hljs-string">&#x27;0&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;NO YOU DONT&#x27;</span>)<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;nominator&#125;</span>//<span class="hljs-subst">&#123;denominator&#125;</span> = <span class="hljs-subst">&#123;nominator//denominator&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> choose == <span class="hljs-string">&#x27;2&#x27;</span>:<br>        <span class="hljs-keyword">try</span>:<br>            ans = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;input the answer: &gt;&gt;&gt; &#x27;</span>)<br>            rand1 = random.getrandbits(<span class="hljs-number">11000</span>)<br>            rand2 = random.getrandbits(<span class="hljs-number">10000</span>)<br>            correct_ans = rand1 // rand2<br>            <span class="hljs-keyword">if</span> correct_ans == <span class="hljs-built_in">int</span>(ans):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;WOW&#x27;</span>)<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Here is your flag: <span class="hljs-subst">&#123;f.read()&#125;</span>&#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;NOPE, the correct answer is <span class="hljs-subst">&#123;correct_ans&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;INPUT NUMBERS&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Invalid choice&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>这是一个伪随机数加密类的题，他是通过除输入的分母1，进行624次，得出内部结构，因此可以预测接下来的数。又由于是11000位和10000位相除，所以精度不必那么高（可以是32的n倍直接求，当然切割也行）<br>注意要精确截取，ai生成的有点小问题，但这位师傅的没问题，稳得一批</p>
<p>文章参考：[<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42557115/article/details/128228201?spm=1001.2014.3001.5502">CTF&#x2F;randcrack]python随机数预测模块分析及改进方案_random.getrandbits(32)-CSDN博客</a></p>
<p>wp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *       <span class="hljs-comment"># 用于网络交互的基础库</span><br><span class="hljs-keyword">from</span> randcrack <span class="hljs-keyword">import</span> RandCrack  <span class="hljs-comment"># MT19937预测器库</span><br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> trange  <span class="hljs-comment"># 进度条显示</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    主函数：实现完整的攻击流程</span><br><span class="hljs-string">    原理：</span><br><span class="hljs-string">    1. MT19937伪随机数生成器基于624个32位内部状态</span><br><span class="hljs-string">    2. 收集624个连续生成的随机数即可重建完整状态</span><br><span class="hljs-string">    3. 利用重建的状态可以预测后续所有随机数</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment"># ==================== 初始化阶段 ====================</span><br>    <span class="hljs-comment"># 初始化预测器对象</span><br>    rc = RandCrack()  <span class="hljs-comment"># 创建MT19937状态预测器</span><br>    <br>    <span class="hljs-comment"># 建立与服务器的连接（重要：确认端口正确性）</span><br>    <span class="hljs-comment"># 注意：这里使用pwntools的remote函数连接指定IP和端口</span><br>    p = remote(<span class="hljs-string">&quot;39.106.69.240&quot;</span>, <span class="hljs-number">24578</span>)  <span class="hljs-comment"># 题目给定的服务器地址和端口</span><br><br>    <span class="hljs-comment"># ================== 状态收集阶段 ====================</span><br>    <span class="hljs-comment"># 需要收集624个连续生成的32位随机数</span><br>    <span class="hljs-comment"># 进度条显示增强交互体验（trange是tqdm的进度条封装）</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> trange(<span class="hljs-number">624</span>, desc=<span class="hljs-string">&quot;Collecting states&quot;</span>):<br>        <span class="hljs-comment"># 发送选项1进入除法计算模式</span><br>        p.sendlineafter(<span class="hljs-string">b&quot;: &gt;&gt;&gt;&quot;</span>, <span class="hljs-string">b&quot;1&quot;</span>)  <span class="hljs-comment"># 当接收到&quot;: &gt;&gt;&gt;&quot;提示时发送选项1</span><br>        <br>        <span class="hljs-comment"># 发送分母1（关键：确保每次计算的分母为1）</span><br>        p.sendlineafter(<span class="hljs-string">b&quot;denominator: &gt;&gt;&gt;&quot;</span>, <span class="hljs-string">b&quot;1&quot;</span>)  <span class="hljs-comment"># 分母设置为1使结果等于分子</span><br>        <br>        <span class="hljs-comment"># 接收服务器响应并解析分子值</span><br>        <span class="hljs-comment"># 响应格式示例：&quot;4294967295//1 = 4294967295&quot;</span><br>        line = p.recvline().decode()     <span class="hljs-comment"># 接收完整响应行</span><br>        numerator = <span class="hljs-built_in">int</span>(line.split(<span class="hljs-string">&#x27;//&#x27;</span>)[<span class="hljs-number">0</span>].strip())  <span class="hljs-comment"># 提取&#x27;//&#x27;前的分子部分</span><br>        <br>        <span class="hljs-comment"># 将分子提交给预测器重建内部状态</span><br>        rc.submit(numerator)  <span class="hljs-comment"># 每次submit会更新预测器的内部状态</span><br><br>    <span class="hljs-comment"># ================ 随机数预测阶段 ====================</span><br>    <span class="hljs-comment"># 生成第一个大整数（11000位）</span><br>    <span class="hljs-comment"># 原理：</span><br>    <span class="hljs-comment"># 1. predict_getrandbits(n)会自动计算需要生成多少次32位随机数</span><br>    <span class="hljs-comment"># 2. 11000位需要344次32位生成（344*32=11008位），然后截取前11000位</span><br>    rand1 = rc.predict_getrandbits(<span class="hljs-number">11000</span>)  <span class="hljs-comment"># 预测11000位随机整数</span><br>    <br>    <span class="hljs-comment"># 生成第二个大整数（10000位）</span><br>    <span class="hljs-comment"># 同理需要313次32位生成（313*32=10016位），截取前10000位</span><br>    rand2 = rc.predict_getrandbits(<span class="hljs-number">10000</span>)  <span class="hljs-comment"># 预测10000位随机整数</span><br>    <br>    <span class="hljs-comment"># 计算整除结果（服务器验证的核心）</span><br>    ans = rand1 // rand2  <span class="hljs-comment"># 大整数除法，Python天然支持高精度计算</span><br><br>    <span class="hljs-comment"># ================== 答案提交阶段 ====================</span><br>    <span class="hljs-comment"># 发送选项2进入答案提交模式</span><br>    p.sendlineafter(<span class="hljs-string">b&quot;: &gt;&gt;&gt;&quot;</span>, <span class="hljs-string">b&quot;2&quot;</span>)  <span class="hljs-comment"># 当出现提示时发送选项2</span><br>    <br>    <span class="hljs-comment"># 提交计算结果（必须转换为字符串格式）</span><br>    p.sendlineafter(<span class="hljs-string">b&quot;answer: &gt;&gt;&gt;&quot;</span>, <span class="hljs-built_in">str</span>(ans).encode())  <span class="hljs-comment"># 编码为字节流发送</span><br><br>    <span class="hljs-comment"># ================== 获取Flag阶段 ====================</span><br>    <span class="hljs-comment"># 进入交互模式查看服务器返回结果</span><br>    <span class="hljs-comment"># 成功时会返回包含flag的信息，失败则显示错误提示</span><br>    p.interactive()  <span class="hljs-comment"># 保持连接交互，直到手动退出</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 执行主函数</span><br>    main()<br></code></pre></td></tr></table></figure>



<h1 id="Complex-signin"><a href="#Complex-signin" class="headerlink" title="Complex_signin"></a>Complex_signin</h1><p>原题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> ChaCha20<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Complex</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, re, im</span>):<br>        <span class="hljs-variable language_">self</span>.re = re<br>        <span class="hljs-variable language_">self</span>.im = im<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__mul__</span>(<span class="hljs-params">self, c</span>):<br>        re_ = <span class="hljs-variable language_">self</span>.re * c.re - <span class="hljs-variable language_">self</span>.im * c.im<br>        im_ = <span class="hljs-variable language_">self</span>.re * c.im + <span class="hljs-variable language_">self</span>.im * c.re<br>        <span class="hljs-keyword">return</span> Complex(re_, im_)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, c</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.re == c.re <span class="hljs-keyword">and</span> <span class="hljs-variable language_">self</span>.im == c.im<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__rshift__</span>(<span class="hljs-params">self, m</span>):<br>        <span class="hljs-keyword">return</span> Complex(<span class="hljs-variable language_">self</span>.re &gt;&gt; m, <span class="hljs-variable language_">self</span>.im &gt;&gt; m)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__lshift__</span>(<span class="hljs-params">self, m</span>):<br>        <span class="hljs-keyword">return</span> Complex(<span class="hljs-variable language_">self</span>.re &lt;&lt; m, <span class="hljs-variable language_">self</span>.im &lt;&lt; m)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-variable language_">self</span>.im == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(<span class="hljs-variable language_">self</span>.re)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-variable language_">self</span>.re == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(<span class="hljs-variable language_">self</span>.im) == <span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;-&#x27;</span> <span class="hljs-keyword">if</span> self.im &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;&#x27;</span>&#125;</span>i&quot;</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.im&#125;</span>i&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.re&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;+&#x27;</span> <span class="hljs-keyword">if</span> self.im &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;-&#x27;</span>&#125;</span> <span class="hljs-subst">&#123;<span class="hljs-built_in">abs</span>(self.im)&#125;</span>i&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tolist</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> [<span class="hljs-variable language_">self</span>.re, <span class="hljs-variable language_">self</span>.im]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">complex_pow</span>(<span class="hljs-params">c, exp, n</span>):<br>    result = Complex(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">while</span> exp &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">if</span> exp &amp; <span class="hljs-number">1</span>:<br>            result = result * c<br>            result.re = result.re % n<br>            result.im = result.im % n<br>        c = c * c<br>        c.re = c.re % n<br>        c.im = c.im % n<br>        exp &gt;&gt;= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> result<br><br>bits = <span class="hljs-number">128</span><br>p = getPrime(<span class="hljs-number">1024</span>)<br>q = getPrime(<span class="hljs-number">1024</span>)<br>n = p * q<br>m = Complex(getRandomRange(<span class="hljs-number">1</span>, n), getRandomRange(<span class="hljs-number">1</span>, n))<br>e = <span class="hljs-number">3</span><br>c = complex_pow(m, e, n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;n = <span class="hljs-subst">&#123;n&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;mh = <span class="hljs-subst">&#123;(m &gt;&gt; bits &lt;&lt; bits).tolist()&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;C = <span class="hljs-subst">&#123;c.tolist()&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;enc = <span class="hljs-subst">&#123;ChaCha20.new(key=hashlib.sha256(<span class="hljs-built_in">str</span>(m.re + m.im).encode()).digest(), nonce=<span class="hljs-string">b&#x27;Pr3d1ctmyxjj&#x27;</span>).encrypt(flag)&#125;</span>&quot;</span>)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">n = 24240993137357567658677097076762157882987659874601064738608971893024559525024581362454897599976003248892339463673241756118600994494150721789525924054960470762499808771760690211841936903839232109208099640507210141111314563007924046946402216384360405445595854947145800754365717704762310092558089455516189533635318084532202438477871458797287721022389909953190113597425964395222426700352859740293834121123138183367554858896124509695602915312917886769066254219381427385100688110915129283949340133524365403188753735534290512113201932620106585043122707355381551006014647469884010069878477179147719913280272028376706421104753</span><br><span class="hljs-string">mh = [3960604425233637243960750976884707892473356737965752732899783806146911898367312949419828751012380013933993271701949681295313483782313836179989146607655230162315784541236731368582965456428944524621026385297377746108440938677401125816586119588080150103855075450874206012903009942468340296995700270449643148025957527925452034647677446705198250167222150181312718642480834399766134519333316989347221448685711220842032010517045985044813674426104295710015607450682205211098779229647334749706043180512861889295899050427257721209370423421046811102682648967375219936664246584194224745761842962418864084904820764122207293014016, 15053801146135239412812153100772352976861411085516247673065559201085791622602365389885455357620354025972053252939439247746724492130435830816513505615952791448705492885525709421224584364037704802923497222819113629874137050874966691886390837364018702981146413066712287361010611405028353728676772998972695270707666289161746024725705731676511793934556785324668045957177856807914741189938780850108643929261692799397326838812262009873072175627051209104209229233754715491428364039564130435227582042666464866336424773552304555244949976525797616679252470574006820212465924134763386213550360175810288209936288398862565142167552]</span><br><span class="hljs-string">C = [5300743174999795329371527870190100703154639960450575575101738225528814331152637733729613419201898994386548816504858409726318742419169717222702404409496156167283354163362729304279553214510160589336672463972767842604886866159600567533436626931810981418193227593758688610512556391129176234307448758534506432755113432411099690991453452199653214054901093242337700880661006486138424743085527911347931571730473582051987520447237586885119205422668971876488684708196255266536680083835972668749902212285032756286424244284136941767752754078598830317271949981378674176685159516777247305970365843616105513456452993199192823148760, 21112179095014976702043514329117175747825140730885731533311755299178008997398851800028751416090265195760178867626233456642594578588007570838933135396672730765007160135908314028300141127837769297682479678972455077606519053977383739500664851033908924293990399261838079993207621314584108891814038236135637105408310569002463379136544773406496600396931819980400197333039720344346032547489037834427091233045574086625061748398991041014394602237400713218611015436866842699640680804906008370869021545517947588322083793581852529192500912579560094015867120212711242523672548392160514345774299568940390940653232489808850407256752]</span><br><span class="hljs-string">enc = b&#x27;\x9c\xc4n\x8dF\xd9\x9e\xf4\x05\x82!\xde\xfe\x012$\xd0\x8c\xaf\xfb\rEb(\x04)\xa1\xa6\xbaI2J\xd2\xb2\x898\x11\xe6x\xa9\x19\x00pn\xf6rs- \xd2\xd1\xbe\xc7\xf51.\xd4\xd2 \xe7\xc6\xca\xe5\x19\xbe&#x27;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>



<p>题解：</p>
<p><img src="/5E283890C76F7FF717066E073BA880D8.jpg" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># sage</span><br><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *  <span class="hljs-comment"># 导入SageMath的数学库</span><br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> ChaCha20  <span class="hljs-comment"># 导入ChaCha20加密库</span><br><span class="hljs-keyword">import</span> hashlib  <span class="hljs-comment"># 导入哈希函数库</span><br><span class="hljs-keyword">import</span> itertools  <span class="hljs-comment"># 导入迭代工具库</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">small_roots</span>(<span class="hljs-params">f, bounds, m=<span class="hljs-number">1</span>, d=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    使用Coppersmith方法求解多项式的小根</span><br><span class="hljs-string">    参数：</span><br><span class="hljs-string">        f: 需要求解的多项式</span><br><span class="hljs-string">        bounds: 变量的上界（如(2^128, 2^128)）</span><br><span class="hljs-string">        m: LLL算法的参数（影响格的构造）</span><br><span class="hljs-string">        d: 多项式的最大次数（默认为多项式次数）</span><br><span class="hljs-string">    返回：</span><br><span class="hljs-string">        满足条件的根列表</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> d:<br>        d = f.degree()  <span class="hljs-comment"># 若未指定d，取多项式次数</span><br><br>    R = f.base_ring()  <span class="hljs-comment"># 获取多项式系数的环（如Zmod(n)）</span><br>    N = R.cardinality()  <span class="hljs-comment"># 环的基数（如n）</span><br><br>    <span class="hljs-comment"># 正规化多项式：将首项系数归一化为1</span><br>    f /= f.coefficients().pop(<span class="hljs-number">0</span>)  <br>    f = f.change_ring(ZZ)  <span class="hljs-comment"># 将多项式转换为整数环上的多项式</span><br><br>    G = <span class="hljs-type">Sequence</span>([], f.parent())  <span class="hljs-comment"># 初始化格基向量列表</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>):<br>        base = N^(m - i) * f^i  <span class="hljs-comment"># 构造基础多项式（用于格的构造）</span><br>        <span class="hljs-keyword">for</span> shifts <span class="hljs-keyword">in</span> itertools.product(<span class="hljs-built_in">range</span>(d), repeat=f.nvariables()):<br>            <span class="hljs-comment"># 枚举所有可能的指数组合（构造格的列）</span><br>            g = base * prod(<span class="hljs-built_in">map</span>(power, f.variables(), shifts))<br>            G.append(g)<br><br>    B, monomials = G.coefficient_matrix()  <span class="hljs-comment"># 提取系数矩阵和单项式</span><br>    monomials = vector(monomials)  <span class="hljs-comment"># 转换为向量形式</span><br><br>    factors = [monomial(*bounds) <span class="hljs-keyword">for</span> monomial <span class="hljs-keyword">in</span> monomials]  <span class="hljs-comment"># 计算缩放因子</span><br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, factor)  <span class="hljs-comment"># 缩放矩阵列</span><br><br>    B = B.dense_matrix().LLL()  <span class="hljs-comment"># 应用LLL算法进行格规约</span><br><br>    B = B.change_ring(QQ)  <span class="hljs-comment"># 转换为有理数环</span><br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, <span class="hljs-number">1</span> / factor)  <span class="hljs-comment"># 反缩放矩阵列</span><br><br>    H = <span class="hljs-type">Sequence</span>([], f.parent().change_ring(QQ))  <span class="hljs-comment"># 初始化新多项式列表</span><br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> <span class="hljs-built_in">filter</span>(<span class="hljs-literal">None</span>, B * monomials):  <span class="hljs-comment"># 生成新多项式</span><br>        H.append(h)<br>        I = H.ideal()  <span class="hljs-comment"># 构造理想</span><br>        <span class="hljs-keyword">if</span> I.dimension() == -<span class="hljs-number">1</span>:  <span class="hljs-comment"># 理想维度不为0，移除最后一个多项式</span><br>            H.pop()<br>        <span class="hljs-keyword">elif</span> I.dimension() == <span class="hljs-number">0</span>:  <span class="hljs-comment"># 理想维度为0，存在解</span><br>            roots = []<br>            <span class="hljs-keyword">for</span> root <span class="hljs-keyword">in</span> I.variety(ring=ZZ):  <span class="hljs-comment"># 求解整数解</span><br>                root = <span class="hljs-built_in">tuple</span>(R(root[var]) <span class="hljs-keyword">for</span> var <span class="hljs-keyword">in</span> f.variables())<br>                roots.append(root)<br>            <span class="hljs-keyword">return</span> roots  <span class="hljs-comment"># 返回第一个解集</span><br>    <span class="hljs-keyword">return</span> []  <span class="hljs-comment"># 无解时返回空列表</span><br><br><span class="hljs-comment"># RSA模数n（大素数的乘积）</span><br>n = <span class="hljs-number">24240993137357567658677097076762157882987659874601064738608971893024559525024581362454897599976003248892339463673241756118600994494150721789525924054960470762499808771760690211841936903839232109208099640507210141111314563007924046946402216384360405445595854947145800754365717704762310092558089455516189533635318084532202438477871458797287721022389909953190113597425964395222426700352859740293834121123138183367554858896124509695602915312917886769066254219381427385100688110915129283949340133524365403188753735534290512113201932620106585043122707355381551006014647469884010069878477179147719913280272028376706421104753</span><br><br><span class="hljs-comment"># 已知的m的高位部分（mh_re为实部高位，mh_im为虚部高位）</span><br>mh = [<br>    <span class="hljs-number">3960604425233637243960750976884707892473356737965752732899783806146911898367312949419828751012380013933993271701949681295313483782313836179989146607655230162315784541236731368582965456428944524621026385297377746108440938677401125816586119588080150103855075450874206012903009942468340296995700270449643148025957527925452034647677446705198250167222150181312718642480834399766134519333316989347221448685711220842032010517045985044813674426104295710015607450682205211098779229647334749706043180512861889295899050427257721209370423421046811102682648967375219936664246584194224745761842962418864084904820764122207293014016</span>,<br>    <span class="hljs-number">15053801146135239412812153100772352976861411085516247673065559201085791622602365389885455357620354025972053252939439247746724492130435830816513505615952791448705492885525709421224584364037704802923497222819113629874137050874966691886390837364018702981146413066712287361010611405028353728676772998972695270707666289161746024725705731676511793934556785324668045957177856807914741189938780850108643929261692799397326838812262009873072175627051209104209229233754715491428364039564130435227582042666464866336424773552304555244949976525797616679252470574006820212465924134763386213550360175810288209936288398862565142167552</span><br>]<br><br><span class="hljs-comment"># 密文C的实部和虚部</span><br>C = [<br>    <span class="hljs-number">5300743174999795329371527870190100703154639960450575575101738225528814331152637733729613419201898994386548816504858409726318742419169717222702404409496156167283354163362729304279553214510160589336672463972767842604886866159600567533436626931810981418193227593758688610512556391129176234307448758534506432755113432411099690991453452199653214054901093242337700880661006486138424743085527911347931571730473582051987520447237586885119205422668971876488684708196255266536680083835972668749902212285032756286424244284136941767752754078598830317271949981378674176685159516777247305970365843616105513456452993199192823148760</span>,<br>    <span class="hljs-number">21112179095014976702043514329117175747825140730885731533311755299178008997398851800028751416090265195760178867626233456642594578588007570838933135396672730765007160135908314028300141127837769297682479678972455077606519053977383739500664851033908924293990399261838079993207621314584108891814038236135637105408310569002463379136544773406496600396931819980400197333039720344346032547489037834427091233045574086625061748398991041014394602237400713218611015436866842699640680804906008370869021545517947588322083793581852529192500912579560094015867120212711242523672548392160514345774299568940390940653232489808850407256752</span><br>]<br><br>enc = <span class="hljs-string">b&#x27;\x9c\xc4n\x8dF\xd9\x9e\xf4\x05\x82!\xde\xfe\x012$\xd0\x8c\xaf\xfb\rEb(\x04)\xa1\xa6\xbaI2J\xd2\xb2\x898\x11\xe6x\xa9\x19\x00pn\xf6rs- \xd2\xd1\xbe\xc7\xf51.\xd4\xd2 \xe7\xc6\xca\xe5\x19\xbe&#x27;</span>  <span class="hljs-comment"># 密文</span><br><br><span class="hljs-comment"># 提取m的实部和虚部高位</span><br>mh_re, mh_im = mh<br>C_re, C_im = C  <span class="hljs-comment"># 提取密文的实部和虚部</span><br><br><span class="hljs-comment"># 构造多项式环（模n）</span><br>PR.&lt;x,y&gt; = PolynomialRing(Zmod(n))<br><br><span class="hljs-comment"># 构造多项式方程：(mh_re + x)^3 - 3*(mh_re + x)*(mh_im + y)^2 ≡ C_re mod n</span><br><span class="hljs-comment"># 该方程基于复数m = (mh_re + x) + (mh_im + y)i的立方模n等于C_re + C_im i的实部</span><br>f = (mh_re + x)**<span class="hljs-number">3</span> - <span class="hljs-number">3</span>*(mh_re + x)*(mh_im + y)**<span class="hljs-number">2</span> - C_re<br><br><span class="hljs-comment"># 求解多项式的小根（x和y的绝对值小于2^128）</span><br>res = small_roots(f, (<span class="hljs-number">2</span>^<span class="hljs-number">128</span>, <span class="hljs-number">2</span>^<span class="hljs-number">128</span>), m=<span class="hljs-number">2</span>, d=<span class="hljs-number">3</span>)  <br><br><span class="hljs-comment"># 计算真实的m_re和m_im</span><br>m_re = mh_re + <span class="hljs-built_in">int</span>(res[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])<br>m_im = mh_im + <span class="hljs-built_in">int</span>(res[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>])<br><br><span class="hljs-comment"># 生成密钥：将m_re + m_im的字符串哈希为32字节的密钥</span><br>key = hashlib.sha256(<span class="hljs-built_in">str</span>(m_re + m_im).encode()).digest()<br><br><span class="hljs-comment"># 解密密文（ChaCha20要求nonce为12字节）</span><br>cipher = ChaCha20.new(key=key, nonce=<span class="hljs-string">b&#x27;Pr3d1ctmyxjj&#x27;</span>)<br>flag = cipher.decrypt(enc).decode()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Flag:&quot;</span>, flag)<br><span class="hljs-comment"># XYCTF&#123;Welcome_to_XYCTF_Now_let_us_together_play_Crypto_challenge&#125;</span><br></code></pre></td></tr></table></figure>



<h1 id="reed"><a href="#reed" class="headerlink" title="reed"></a>reed</h1><p>原题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag  <span class="hljs-comment"># 从secret模块导入flag</span><br><br><span class="hljs-comment"># 验证flag格式是否正确（必须以&#x27;XYCTF&#123;&#x27;开头，&#x27;&#125;&#x27;结尾）</span><br><span class="hljs-keyword">assert</span> flag.startswith(<span class="hljs-string">&#x27;XYCTF&#123;&#x27;</span>) <span class="hljs-keyword">and</span> flag.endswith(<span class="hljs-string">&#x27;&#125;&#x27;</span>)<br><br><span class="hljs-comment"># 去除flag的外层包装，获取核心内容</span><br>flag = flag.rstrip(<span class="hljs-string">&#x27;&#125;&#x27;</span>).lstrip(<span class="hljs-string">&#x27;XYCTF&#123;&#x27;</span>)<br><br><span class="hljs-comment"># 定义字符表 - 包含所有大小写字母和数字（a-z, A-Z, 0-9）</span><br>table = string.ascii_letters + string.digits<br><br><span class="hljs-comment"># 确保flag中的所有字符都在字符表中</span><br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">all</span>(i <span class="hljs-keyword">in</span> table <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag)<br><br><span class="hljs-comment"># 创建随机数生成器实例</span><br>r = random.Random()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PRNG</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;自定义伪随机数生成器，带有特殊的种子更新机制&quot;&quot;&quot;</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, seed</span>):<br>        <span class="hljs-comment"># 定义随机数生成范围</span><br>        <span class="hljs-variable language_">self</span>.a = <span class="hljs-number">1145140</span>      <span class="hljs-comment"># 最小值</span><br>        <span class="hljs-variable language_">self</span>.b = <span class="hljs-number">19198100</span>     <span class="hljs-comment"># 最大值</span><br>        <span class="hljs-comment"># 初始化随机种子</span><br>        random.seed(seed)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">next</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;生成下一个随机数并基于该数更新种子&quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 在固定范围内生成随机数</span><br>        x = random.randint(<span class="hljs-variable language_">self</span>.a, <span class="hljs-variable language_">self</span>.b)<br>        <span class="hljs-comment"># 用该数的平方+1作为新种子（关键特性）</span><br>        random.seed(x ** <span class="hljs-number">2</span> + <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> x<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">round</span>(<span class="hljs-params">self, k</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;生成k个随机数并返回最后一个&quot;&quot;&quot;</span><br>        x = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>            x = <span class="hljs-variable language_">self</span>.<span class="hljs-built_in">next</span>()<br>        <span class="hljs-keyword">return</span> x<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">msg, a, b</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;使用线性同余算法加密消息&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 对消息中的每个字符：</span><br>    <span class="hljs-comment"># 1. 找到它在字符表中的索引</span><br>    <span class="hljs-comment"># 2. 应用公式 (a * 索引 + b) mod 19198111</span><br>    c = [(a * table.index(m) + b) % <span class="hljs-number">19198111</span> <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> msg]<br>    <span class="hljs-keyword">return</span> c<br><br><span class="hljs-comment"># 获取用户输入的种子值</span><br>seed = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;请输入种子: &#x27;</span>))<br><br><span class="hljs-comment"># 用用户提供的种子初始化PRNG</span><br>prng = PRNG(seed)<br><br><span class="hljs-comment"># 生成加密参数a和b：</span><br><span class="hljs-comment"># - 每个参数都是通过PRNG运行随机轮次得到的</span><br><span class="hljs-comment"># - 轮次数范围是0到65535（2^16-1）</span><br>a = prng.<span class="hljs-built_in">round</span>(r.randrange(<span class="hljs-number">2</span>**<span class="hljs-number">16</span>))<br>b = prng.<span class="hljs-built_in">round</span>(r.randrange(<span class="hljs-number">2</span>**<span class="hljs-number">16</span>))<br><br><span class="hljs-comment"># 用生成的参数加密flag</span><br>enc = encrypt(flag, a, b)<br><br><span class="hljs-comment"># 输出加密结果</span><br><span class="hljs-built_in">print</span>(enc)<br></code></pre></td></tr></table></figure>





<p>我们知道她的加密过程：    c &#x3D; [(a * table.index(m) + b) % 19198111 for m in msg]，这是同余式。</p>
<p>然后，我们输入随机种子可以得到密文c，我们要想得到明文m，就需要得到a和b，而明文m的范围为ASCII值0到61，也就是说我们：<br>$$<br>c<br>0<br>​<br> ≡a∗m<br>0<br>​<br> +b%p<br>$$</p>
<p>$$<br>c<br>1<br>​<br> ≡a∗m<br>1<br>​<br> +b%p<br>$$</p>
<p>$$<br>a≡(c<br>0<br>​<br> −c<br>1<br>​<br> )∗(m<br>0<br>​<br> −m<br>1<br>​<br> )<br>−1<br> %p<br>$$</p>
<p>$$<br>只要GCD(m<br>0<br>​<br> −m<br>1<br>​<br> ,p)&#x3D;1，逆元即存在<br>$$</p>
<p>其实我们只要m循环取0到61，满足公式条件就能得出a和b，进而得出明文m为什么。</p>
<p>至于为什么GCD&#x3D;1,逆元存在：X*X-1&#x3D;1 modp,当且仅当GCD（X，p)&#x3D;1时，X-1才存在（乘法逆元）</p>
<p>遍历两遍m,判断得出的a，b是不是满足范围：</p>
<p><a target="_blank" rel="noopener" href="https://hvang10.github.io/2025/04/08/XYCTF2025-WriteUp/index.html">XYCTF2025-WriteUp | HvAng’s Nests</a></p>
<p>代码（直接搬了上面这位师傅的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> json<br><br>io = remote(<span class="hljs-string">&quot;39.106.48.123&quot;</span>, <span class="hljs-number">34301</span>)<br><br>table = string.ascii_letters + string.digits<br>p = <span class="hljs-number">19198111</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">egcd</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">if</span> a == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> (b, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br>        g, y, x = egcd(b % a, a)<br>        <span class="hljs-keyword">return</span> (g, x - (b // a) * y, y)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">modinv</span>(<span class="hljs-params">a, mod</span>):<br>    g, x, y = egcd(a, mod)<br>    <span class="hljs-keyword">if</span> g != <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> x % mod<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">enc</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(enc)):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(enc)):<br>            c0 = enc[i]<br>            c1 = enc[j]<br>            <span class="hljs-keyword">for</span> m0 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(table)):<br>                <span class="hljs-keyword">for</span> m1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(table)):<br>                    <span class="hljs-keyword">if</span> m0 == m1:<br>                        <span class="hljs-keyword">continue</span><br>                    delta_m = m1 - m0<br>                    delta_c = (c1 - c0) % p<br>                    inv = modinv(delta_m, p)<br>                    <span class="hljs-keyword">if</span> inv <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                        <span class="hljs-keyword">continue</span><br>                    a = (delta_c * inv) % p<br>                    b = (c0 - a * m0) % p<br>                    <span class="hljs-comment"># Check if a and b are within PRNG&#x27;s output range</span><br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (<span class="hljs-number">1145140</span> &lt;= a &lt;= <span class="hljs-number">19198100</span>):<br>                        <span class="hljs-keyword">continue</span><br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (<span class="hljs-number">1145140</span> &lt;= b &lt;= <span class="hljs-number">19198100</span>):<br>                        <span class="hljs-keyword">continue</span><br>                    valid = <span class="hljs-literal">True</span><br>                    decrypted = []<br>                    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> enc:<br>                        numerator = (c - b) % p<br>                        inv_a = modinv(a, p)<br>                        <span class="hljs-keyword">if</span> inv_a <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                            valid = <span class="hljs-literal">False</span><br>                            <span class="hljs-keyword">break</span><br>                        m = (numerator * inv_a) % p<br>                        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (<span class="hljs-number">0</span> &lt;= m &lt; <span class="hljs-built_in">len</span>(table)):<br>                            valid = <span class="hljs-literal">False</span><br>                            <span class="hljs-keyword">break</span><br>                        decrypted.append(table[m])<br>                    <span class="hljs-keyword">if</span> valid:<br>                        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(decrypted)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;解密失败&quot;</span><br><br><br>io.recvuntil(<span class="hljs-string">b&#x27;give me seed: &#x27;</span>)<br>io.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-number">114514</span>))<br>enc = json.loads(io.recvline().decode())<br>flag = decrypt(enc)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密后的Flag:&quot;</span>, <span class="hljs-string">f&#x27;XYCTF&#123;&#123;<span class="hljs-subst">&#123;flag&#125;</span>&#125;&#125;&#x27;</span>)<br><span class="hljs-comment"># 解密后的Flag: XYCTF&#123;114514fixedpointissodangerous1919810&#125;</span><br></code></pre></td></tr></table></figure>



<p>然后还有一个题解：</p>
<p>上面那个题解据出题人languag3说是自己脑子抽了加了个仿射加密，实际上算是非预期了，预期题解是输入不同的seed找循环的规律得出，然后枚举a和b来计算flag，此话在Initialization的wp中亦有分析：<a target="_blank" rel="noopener" href="https://collectcrop.github.io/blog/2025/04/08/2025xyctf-wp/#%E4%B8%80%E6%88%98%E9%98%9F%E4%BF%A1%E6%81%AF">2025xyctf wp | Collectcrop’s Blog</a></p>
<p>1.看题目。大概就是用户提供一个种子，使用该种子初始化PRNG生成两个参数a和b，然后使用线性同余加密方式加密flag，(a * table.index(m) + b) % 19198111。</p>
<p>2.nc上之后可以看到，虽然每次得到的密文组不同，但是固定的几个位置上的数一定是相同的，比如1，2，5…。说明这几个位置上的明文是相同的，如果可以先猜测这些位置上的明文，就可以列方程组解a,b，由此再去解剩余的密文。（说实话是遍历试的明文，代码总是有点问题改了很久，答案出来之后只能说哎，这怎么能没看出来，这相同的位置，这提示，哎）</p>
<p>随便一组数据测试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> combinations<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inverse</span>(<span class="hljs-params">a, m</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extended_gcd</span>(<span class="hljs-params">a, b</span>):<br>        <span class="hljs-keyword">if</span> a == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> b, <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            gcd, x, y = extended_gcd(b % a, a)<br>            <span class="hljs-keyword">return</span> gcd, y - (b // a) * x, x<br><br>    gcd, x, _ = extended_gcd(a, m)<br>    <span class="hljs-keyword">if</span> gcd != <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;a在模m下没有逆&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> x % m<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>(<span class="hljs-params">cipher, table, m</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;解密cipher&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 找到重复值</span><br>    repeated = [c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span>(cipher) <span class="hljs-keyword">if</span> cipher.count(c) &gt; <span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(repeated) &lt; <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Not enough repeated values to solve&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-comment"># 遍历可能的重复值组合</span><br>    <span class="hljs-keyword">for</span> c0, c1 <span class="hljs-keyword">in</span> combinations(cipher, <span class="hljs-number">2</span>):<br>        pos0 = cipher.index(c0)<br>        pos1 = cipher.index(c1)<br><br>        <span class="hljs-comment"># 遍历可能的字符组合</span><br>        <span class="hljs-keyword">for</span> i0 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(table)):<br>            <span class="hljs-keyword">for</span> i1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(table)):<br>                <span class="hljs-keyword">if</span> i0 == i1:<br>                    <span class="hljs-keyword">continue</span><br><br>                <span class="hljs-keyword">try</span>:<br>                    a = (c1 - c0) * inverse(i1 - i0, m) % m<br>                    b = (c0 - a * i0) % m<br>                <span class="hljs-keyword">except</span>:<br>                    <span class="hljs-keyword">continue</span><br><br>                <span class="hljs-comment"># 检查a和b范围</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (<span class="hljs-number">1145140</span> &lt;= a &lt;= <span class="hljs-number">19198100</span>):<br>                    <span class="hljs-keyword">continue</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (<span class="hljs-number">1145140</span> &lt;= b &lt;= <span class="hljs-number">19198100</span>):<br>                    <span class="hljs-keyword">continue</span><br><br>                <span class="hljs-comment"># 解密全部</span><br>                <span class="hljs-keyword">try</span>:<br>                    inv_a = inverse(a, m)<br>                    flag = []<br>                    valid = <span class="hljs-literal">True</span><br>                    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> cipher:<br>                        numerator = (c - b) % m<br>                        m_idx = (numerator * inv_a) % m<br>                        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (<span class="hljs-number">0</span> &lt;= m_idx &lt; <span class="hljs-built_in">len</span>(table)):<br>                            valid = <span class="hljs-literal">False</span><br>                            <span class="hljs-keyword">break</span><br>                        flag.append(table[m_idx])<br>                    <span class="hljs-keyword">if</span> valid:<br>                        flag_str = <span class="hljs-string">&#x27;&#x27;</span>.join(flag)<br>                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Possible flag: <span class="hljs-subst">&#123;flag_str&#125;</span>&quot;</span>)<br>                        <span class="hljs-keyword">return</span><br>                <span class="hljs-keyword">except</span>:<br>                    <span class="hljs-keyword">continue</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Failed to decrypt&quot;</span>)<br><br><span class="hljs-comment"># 测试</span><br>table = string.ascii_letters + string.digits<br>m = <span class="hljs-number">19198111</span><br><br><span class="hljs-comment"># 测试数据</span><br>cipher = [<span class="hljs-number">13690524</span>, <span class="hljs-number">13690524</span>, <span class="hljs-number">8208775</span>, <span class="hljs-number">19180266</span>, <span class="hljs-number">13690524</span>, <span class="hljs-number">8208775</span>, <span class="hljs-number">5407953</span>, <span class="hljs-number">19124315</span>, <span class="hljs-number">10913681</span>, <span class="hljs-number">13634573</span>, <span class="hljs-number">2663082</span>, <span class="hljs-number">19132308</span>, <span class="hljs-number">8160817</span>, <span class="hljs-number">19124315</span>, <span class="hljs-number">16387437</span>, <span class="hljs-number">5423939</span>, <span class="hljs-number">19124315</span>, <span class="hljs-number">13650559</span>, <span class="hljs-number">13650559</span>, <span class="hljs-number">8160817</span>, <span class="hljs-number">2663082</span>, <span class="hljs-number">8144831</span>, <span class="hljs-number">16387437</span>, <span class="hljs-number">16379444</span>, <span class="hljs-number">13634573</span>, <span class="hljs-number">2679068</span>, <span class="hljs-number">8160817</span>, <span class="hljs-number">16395430</span>, <span class="hljs-number">13650559</span>, <span class="hljs-number">13690524</span>, <span class="hljs-number">5471897</span>, <span class="hljs-number">13690524</span>, <span class="hljs-number">5471897</span>, <span class="hljs-number">13698517</span>, <span class="hljs-number">13690524</span>, <span class="hljs-number">2719033</span>]<br>solve(cipher, table, m)<br><br><br><br></code></pre></td></tr></table></figure>





<h1 id="choice"><a href="#choice" class="headerlink" title="choice"></a>choice</h1><p>原题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> bytes_to_long<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> Random<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><br><span class="hljs-keyword">assert</span> flag.startswith(<span class="hljs-string">b&#x27;XYCTF&#123;&#x27;</span>) <span class="hljs-keyword">and</span> flag.endswith(<span class="hljs-string">b&#x27;&#125;&#x27;</span>)<br>flag = flag[<span class="hljs-number">6</span>:-<span class="hljs-number">1</span>]<br><br>msg = bytes_to_long(flag)<br>rand = Random()<br>test = <span class="hljs-built_in">bytes</span>([i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">255</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>)])<br><span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;output.py&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>).write(<span class="hljs-string">f&#x27;enc = <span class="hljs-subst">&#123;msg ^ rand.getrandbits(msg.bit_length())&#125;</span>\nr = <span class="hljs-subst">&#123;[rand.choice(test) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2496</span>)]&#125;</span>&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>题中还给了一份random.py的附件，改了第246行，变成了k&#x3D;n.bit_length()-1</p>
<p>这意味着什么？意味着他会输出8位的随机数，也就是0到255，其实还是MT19937，看来得抽空系统的学学这个了，并且到明出几个题玩玩</p>
<p>回到正题：至于为什么变成8位就好解密的多，那是因为题中说了0到255的索引，并且是2496次，那意味着我们</p>
<p>可以得出624位已知数，这样就能破解次伪随机数，进而解密。哦，对了，要饭转一下才能推出已知数，然后破解：</p>
<p>这里还是<strong>MT19937</strong>，伪随机数算法的缺陷，<strong>2496*8&#x3D;19968</strong>刚好够一轮<code>state</code>，注意到我们这里需要的是<strong>逆推</strong>上一个<code>state</code>(相当于反向预测吧)</p>
<p><a target="_blank" rel="noopener" href="https://picx.zhimg.com/80/v2-4cd29979ffa498905e34d294cc0fc69a_1440w.png"><img src="https://picx.zhimg.com/80/v2-4cd29979ffa498905e34d294cc0fc69a_1440w.png" srcset="/img/loading.gif" lazyload alt="img"></a><br>所以<code>r</code>需要取反处理一下</p>
<p>参考：<a target="_blank" rel="noopener" href="https://hvang10.github.io/2025/04/08/XYCTF2025-WriteUp/index.html">XYCTF2025-WriteUp | HvAng’s Nests</a></p>
<p>题解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># sage</span><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># https://github.com/JuliaPoo/MT19937-Symbolic-Execution-and-Solver</span><br>sys.path.append(<span class="hljs-string">&#x27;MT19937-Symbolic-Execution-and-Solver-master/source&#x27;</span>)<br><br><span class="hljs-keyword">from</span> MT19937 <span class="hljs-keyword">import</span> MT19937<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>enc = <span class="hljs-number">5042764371819053176884777909105310461303359296255297</span><br>length = enc.bit_length()<br><span class="hljs-built_in">print</span>(length)<br>r = []<br>r = [<span class="hljs-number">255</span>-i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> r]<br>rng_clone = MT19937(state_from_data = (r, <span class="hljs-number">8</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getrandbits</span>(<span class="hljs-params">n</span>):<br>    num = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n//<span class="hljs-number">32</span>):<br>        num = (rng_clone() &lt;&lt; (<span class="hljs-number">32</span> * i)) | num<br>    num = rng_clone() &gt;&gt; (<span class="hljs-number">32</span> - (n % <span class="hljs-number">32</span>)) &lt;&lt; n//<span class="hljs-number">32</span>*<span class="hljs-number">32</span> | num<br>    <span class="hljs-keyword">return</span> num<br><br>rng_clone.reverse_states(length//<span class="hljs-number">32</span>+<span class="hljs-number">1</span>)  <span class="hljs-comment"># 回退到生成前n个随机数之前的状态</span><br>flag = enc ^^ getrandbits(<span class="hljs-number">176</span>-<span class="hljs-number">1</span>)    <span class="hljs-comment"># 172/8=21.5,22*8=176,可能存在误差所以减1试试</span><br>flag = <span class="hljs-string">b&#x27;XYCTF&#123;&#x27;</span>+long_to_bytes(flag)+<span class="hljs-string">b&#x27;&#125;&#x27;</span><br><span class="hljs-built_in">print</span>(flag.decode())<br><span class="hljs-comment"># XYCTF&#123;___0h_51mple_r@nd0m___&#125;</span><br></code></pre></td></tr></table></figure>





<h1 id="复复复数"><a href="#复复复数" class="headerlink" title="复复复数"></a>复复复数</h1><p>原题：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ComComplex</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value=[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]</span>):<br>        <span class="hljs-variable language_">self</span>.value = value<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        s = <span class="hljs-built_in">str</span>(<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">for</span> k,i <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">1</span>:]):<br>            <span class="hljs-keyword">if</span> i &gt;= <span class="hljs-number">0</span>:<br>                s += <span class="hljs-string">&#x27;+&#x27;</span><br>            s += <span class="hljs-built_in">str</span>(i) +<span class="hljs-string">&#x27;ijk&#x27;</span>[k]<br>        <span class="hljs-keyword">return</span> s<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self,x</span>):<br>        <span class="hljs-keyword">return</span> ComComplex([i+j <span class="hljs-keyword">for</span> i,j <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(<span class="hljs-variable language_">self</span>.value,x.value)])<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__mul__</span>(<span class="hljs-params">self,x</span>):<br>        a = <span class="hljs-variable language_">self</span>.value[<span class="hljs-number">0</span>]*x.value[<span class="hljs-number">0</span>]-<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">1</span>]*x.value[<span class="hljs-number">1</span>]-<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">2</span>]*x.value[<span class="hljs-number">2</span>]-<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">3</span>]*x.value[<span class="hljs-number">3</span>]<br>        b = <span class="hljs-variable language_">self</span>.value[<span class="hljs-number">0</span>]*x.value[<span class="hljs-number">1</span>]+<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">1</span>]*x.value[<span class="hljs-number">0</span>]+<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">2</span>]*x.value[<span class="hljs-number">3</span>]-<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">3</span>]*x.value[<span class="hljs-number">2</span>]<br>        c = <span class="hljs-variable language_">self</span>.value[<span class="hljs-number">0</span>]*x.value[<span class="hljs-number">2</span>]-<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">1</span>]*x.value[<span class="hljs-number">3</span>]+<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">2</span>]*x.value[<span class="hljs-number">0</span>]+<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">3</span>]*x.value[<span class="hljs-number">1</span>]<br>        d = <span class="hljs-variable language_">self</span>.value[<span class="hljs-number">0</span>]*x.value[<span class="hljs-number">3</span>]+<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">1</span>]*x.value[<span class="hljs-number">2</span>]-<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">2</span>]*x.value[<span class="hljs-number">1</span>]+<span class="hljs-variable language_">self</span>.value[<span class="hljs-number">3</span>]*x.value[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">return</span> ComComplex([a,b,c,d])<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__mod__</span>(<span class="hljs-params">self,x</span>):<br>        <span class="hljs-keyword">return</span> ComComplex([i % x <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.value])<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__pow__</span>(<span class="hljs-params">self, x, n=<span class="hljs-literal">None</span></span>):<br>        tmp = ComComplex(<span class="hljs-variable language_">self</span>.value)<br>        a = ComComplex([<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">while</span> x:<br>            <span class="hljs-keyword">if</span> x &amp; <span class="hljs-number">1</span>:<br>                a *= tmp<br>            tmp *= tmp<br>            <span class="hljs-keyword">if</span> n:<br>                a %= n<br>                tmp %= n<br>            x &gt;&gt;= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> a<br><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag, hint<br><br>p = getPrime(<span class="hljs-number">256</span>)<br>q = getPrime(<span class="hljs-number">256</span>)<br>r = getPrime(<span class="hljs-number">256</span>)<br>n = p * q * r<br><br>P = getPrime(<span class="hljs-number">512</span>)<br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(hint) == <span class="hljs-number">20</span><br>hints = ComComplex([bytes_to_long(hint[i:i+<span class="hljs-number">5</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">20</span>,<span class="hljs-number">5</span>)])<br>keys = ComComplex([<span class="hljs-number">0</span>, p, q, r])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hint =&#x27;</span>,hints)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;gift =&#x27;</span>,hints*keys%P)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;P =&#x27;</span>,P)<br><br>e = <span class="hljs-number">65547</span><br>m = ComComplex([bytes_to_long(flag[i:i+<span class="hljs-built_in">len</span>(flag)//<span class="hljs-number">4</span>+<span class="hljs-number">1</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(flag),<span class="hljs-built_in">len</span>(flag)//<span class="hljs-number">4</span>+<span class="hljs-number">1</span>)])<br>c = <span class="hljs-built_in">pow</span>(m, e, n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;n =&#x27;</span>, n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;c =&#x27;</span>, c)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">hint = 375413371936+452903063925i+418564633198j+452841062207k</span><br><span class="hljs-string">gift = 8123312244520119413231609191866976836916616973013918670932199631084038015924368317077919454611785179950870055560079987034735836668109705445946887481003729+20508867471664499348708768798854433383217801696267611753941328714877299161068885700412171i+22802458968832151777449744120185122420871929971817937643641589637402679927558503881707868j+40224499597522456323122179021760594618350780974297095023316834212332206526399536884102863k</span><br><span class="hljs-string">P = 8123312244520119413231609191866976836916616973013918670932199631182724263362174895104545305364960781233690810077210539091362134310623408173268475389315109</span><br><span class="hljs-string">n = 408713495380933615345467409596399184629824932933932227692519320046890365817329617301604051766392980053993030281090124694858194866782889226223493799859404283664530068697313752856923001112586828837146686963124061670340088332769524367</span><br><span class="hljs-string">c = 212391106108596254648968182832931369624606731443797421732310126161911908195602305474921714075911012622738456373731638115041135121458776339519085497285769160263024788009541257401354037620169924991531279387552806754098200127027800103+24398526281840329222660628769015610312084745844610670698920371305353888694519135578269023873988641161449924124665731242993290561874625654977013162008430854786349580090169988458393820787665342793716311005178101342140536536153873825i+45426319565874516841189981758358042952736832934179778483602503215353130229731883231784466068253520728052302138781204883495827539943655851877172681021818282251414044916889460602783324944030929987991059211909160860125047647337380125j+96704582331728201332157222706704482771142627223521415975953255983058954606417974983056516338287792260492498273014507582247155218239742778886055575426154960475637748339582574453542182586573424942835640846567809581805953259331957385k</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br></code></pre></td></tr></table></figure>



<p>这个题，先看这个</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;gift =&#x27;</span>,hints*keys%P)<br></code></pre></td></tr></table></figure>

<p>将数据联系起来。</p>
<p>看它定义的四元数的加减乘除运算规则。我们在只有未知量keys不知道的情况下可以，通过运算求出keys，进而求出pqr，然后就是求四数RSA了，u1s1我不咋会，大概有个印象，好像就是要开根，贴贴别人的文章</p>
<p>[2025 XYCTF - weyung](<a target="_blank" rel="noopener" href="https://blog.weyung.cc/2025/04/04/2025">https://blog.weyung.cc/2025/04/04/2025</a> XYCTF&#x2F;#Crypto)</p>
<p><a target="_blank" rel="noopener" href="https://triodelzx.github.io/2025/04/10/XYCTF-2025-%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AEWrite-Up/index.html#%E5%A4%8D%E5%A4%8D%E5%A4%8D%E5%A4%8D%E6%95%B0">XYCTF 2025 部分题目Write Up | Triode Field</a></p>
<p>题解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><br>h = [<span class="hljs-number">375413371936</span>, <span class="hljs-number">452903063925</span>, <span class="hljs-number">418564633198</span>, <span class="hljs-number">452841062207</span>]<br>g = [<span class="hljs-number">8123312244520119413231609191866976836916616973013918670932199631084038015924368317077919454611785179950870055560079987034735836668109705445946887481003729</span>, <span class="hljs-number">20508867471664499348708768798854433383217801696267611753941328714877299161068885700412171</span>, <span class="hljs-number">22802458968832151777449744120185122420871929971817937643641589637402679927558503881707868</span>, <span class="hljs-number">40224499597522456323122179021760594618350780974297095023316834212332206526399536884102863</span>]<br>P = <span class="hljs-number">8123312244520119413231609191866976836916616973013918670932199631182724263362174895104545305364960781233690810077210539091362134310623408173268475389315109</span><br>n = <span class="hljs-number">408713495380933615345467409596399184629824932933932227692519320046890365817329617301604051766392980053993030281090124694858194866782889226223493799859404283664530068697313752856923001112586828837146686963124061670340088332769524367</span><br><br>H = matrix(Zmod(P),<br>[[h[<span class="hljs-number">0</span>], h[<span class="hljs-number">1</span>], h[<span class="hljs-number">2</span>], h[<span class="hljs-number">3</span>]],<br>[-h[<span class="hljs-number">1</span>], h[<span class="hljs-number">0</span>], -h[<span class="hljs-number">3</span>], h[<span class="hljs-number">2</span>]],<br>[-h[<span class="hljs-number">2</span>], h[<span class="hljs-number">3</span>], h[<span class="hljs-number">0</span>], -h[<span class="hljs-number">1</span>]],<br>[-h[<span class="hljs-number">3</span>], -h[<span class="hljs-number">2</span>], h[<span class="hljs-number">1</span>], h[<span class="hljs-number">0</span>]]])<br><br>G = matrix(Zmod(P),<br>[[g[<span class="hljs-number">0</span>], g[<span class="hljs-number">1</span>], g[<span class="hljs-number">2</span>], g[<span class="hljs-number">3</span>]],<br>[-g[<span class="hljs-number">1</span>], g[<span class="hljs-number">0</span>], -g[<span class="hljs-number">3</span>], g[<span class="hljs-number">2</span>]],<br>[-g[<span class="hljs-number">2</span>], g[<span class="hljs-number">3</span>], g[<span class="hljs-number">0</span>], -g[<span class="hljs-number">1</span>]],<br>[-g[<span class="hljs-number">3</span>], -g[<span class="hljs-number">2</span>], g[<span class="hljs-number">1</span>], g[<span class="hljs-number">0</span>]]])<br><br>K = H^-<span class="hljs-number">1</span> * G<br>_, p, q, r = K[<span class="hljs-number">0</span>]<br><span class="hljs-keyword">assert</span> ZZ(p) * ZZ(q) * ZZ(r) == n<br><br>p, q, r = ZZ(p), ZZ(q), ZZ(r)<br><span class="hljs-built_in">print</span>(p)<br><span class="hljs-built_in">print</span>(q)<br><span class="hljs-built_in">print</span>(r)<br>c = [<span class="hljs-number">212391106108596254648968182832931369624606731443797421732310126161911908195602305474921714075911012622738456373731638115041135121458776339519085497285769160263024788009541257401354037620169924991531279387552806754098200127027800103</span>, <span class="hljs-number">24398526281840329222660628769015610312084745844610670698920371305353888694519135578269023873988641161449924124665731242993290561874625654977013162008430854786349580090169988458393820787665342793716311005178101342140536536153873825</span>, <span class="hljs-number">45426319565874516841189981758358042952736832934179778483602503215353130229731883231784466068253520728052302138781204883495827539943655851877172681021818282251414044916889460602783324944030929987991059211909160860125047647337380125</span>, <span class="hljs-number">96704582331728201332157222706704482771142627223521415975953255983058954606417974983056516338287792260492498273014507582247155218239742778886055575426154960475637748339582574453542182586573424942835640846567809581805953259331957385</span>]<br><br>C = matrix(Zmod(n),<br>[[c[<span class="hljs-number">0</span>], c[<span class="hljs-number">1</span>], c[<span class="hljs-number">2</span>], c[<span class="hljs-number">3</span>]],<br>[-c[<span class="hljs-number">1</span>], c[<span class="hljs-number">0</span>], -c[<span class="hljs-number">3</span>], c[<span class="hljs-number">2</span>]],<br>[-c[<span class="hljs-number">2</span>], c[<span class="hljs-number">3</span>], c[<span class="hljs-number">0</span>], -c[<span class="hljs-number">1</span>]],<br>[-c[<span class="hljs-number">3</span>], -c[<span class="hljs-number">2</span>], c[<span class="hljs-number">1</span>], c[<span class="hljs-number">0</span>]]])<br><br>e = <span class="hljs-number">65547</span><br>phi = (p**<span class="hljs-number">4</span> - <span class="hljs-number">1</span>)*(q**<span class="hljs-number">4</span> - <span class="hljs-number">1</span>)*(r**<span class="hljs-number">4</span> - <span class="hljs-number">1</span>)//<span class="hljs-number">27</span><br><br>d = inverse_mod(e, phi)<br>M = C^d<br><br>res = M[<span class="hljs-number">0</span>]<br>flag = <span class="hljs-string">b&quot;&quot;</span><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> res:<br>    flag += long_to_bytes(ZZ(x))<br><br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-string">b&#x27;flag&#123;Quaternion_15_ComComComComplexXXX!!!?&#125;&#x27;</span><br><br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF/" class="category-chain-item">CTF</a>
  
  
    <span>></span>
    
  <a href="/categories/CTF/%E5%AF%86%E7%A0%81/" class="category-chain-item">密码</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CTF/" class="print-no-link">#CTF</a>
      
        <a href="/tags/%E5%AF%86%E7%A0%81/" class="print-no-link">#密码</a>
      
        <a href="/tags/%E5%A5%BD%E9%A2%98/" class="print-no-link">#好题</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>2025XYCTFCTF</div>
      <div>http://tow-086.github.io/2025/04/17/2025XYCTF/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Agent</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年4月17日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/05/30/2025litctf/" title="2025litCTF">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">2025litCTF</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/03/19/RSA%E7%B3%BB%E5%88%97/" title="RSA系列">
                        <span class="hidden-mobile">RSA系列</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
